---
resources:
  - name: security-advisory-dashboard-git
    icon: github-circle
    type: git
    source:
      uri: https://github.com/alphagov/cyber-security-security-advisory-dashboard
      branch: remove_frontend

  - name: docker-image
    type: docker-image
    source:
      username: ((docker_username))
      password: ((docker_password))
      repository: ((docker_username))/sec_adv

jobs:

- name: sec_adv_build_docker_image
  serial: true
  build_logs_to_retain: 10
  plan:
    - get: security-advisory-dashboard-git
      trigger: true

    - put: docker-image
      params:
        build: security-advisory-dashboard-git
        tag_as_latest: true

- name: sec_adv_tests
  serial: true
  plan:
    - get: docker-image
      trigger: true

    - task: test
      config:
        inputs:
          - name: docker-image

        params:
          TOKEN: faketoken
          GITHUB_ORG: fakeorg

        platform: linux
        image_resource:
          type: docker-image
          source:
            repository: ((docker_username))/sec_adv

        run:
          path: /bin/bash
          args:
            - test.sh
          dir: ../../../usr/src/app
